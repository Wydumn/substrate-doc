# 密码学

密码学提供了共识系统、数据完整性和用户安全性背后的数学可验证性。虽然理解密码学与区块链相关的基本总体应用对于普通开发人员来说至关重要，但底层数学过程本身并不一定相关。本页为整个 Parity 和生态系统中的各种加密实现提供了基本上下文。

## 哈希函数

**哈希**是一个数学过程，它使用介于 2的0次方到2的255次方之间的随机和唯一数字输入，在任何数据片段和一个32字节引用之间创建一对一映射。使用哈希函数，任何数据（包括简单文本、图像或任何其他形式的文件）都会被赋予一个独特且完全唯一的标识符。哈希用于验证数据完整性、创建数字签名以及提供存储密码的安全方法。这种形式的映射被称为“鸽子洞原理”，它主要用于高效且可验证地识别来自大型集合的数据。

这些函数是**确定性的**，这意味着相同的输入将始终产生相同的输出。这对于确保两台不同的计算机可以就相同的数据达成一致非常重要。它们可以设计为快或慢，具体取决于目的。当速度很重要时使用快速哈希函数，而当安全性是优先事项时，使用慢速哈希函数。慢速哈希函数还用于通过增加查找数据所需的工作量来缓解暴力攻击的成功率。

### 抗碰撞性

在区块链中，哈希函数也用于提供**抗碰撞性**。这些操作由攻击者执行，该攻击者计算或控制两个数字输入，试图找到两个相同的值以获取对加密对象的访问权限。对于部分冲突，应用类似的方法，但仅尝试查找共享前几位而不是整体的两个值。

虽然仅实现部分抗碰撞在计算上更轻，并且提供了相当强大的保护以防止碰撞的可能性，但在面对资源充足的对手（如国家）时，它是一个不太安全的选择，因为它更容易通过大量算力暴力破解超过前几位数字。也就是说，对于一般攻击媒介（即流氓参与者）是可以接受的。

### Blake2

在设计新的区块链协议或生态系统时，重要的是要考虑所使用的加密方法的计算成本。优先考虑效率和处理器负载，Substrate使用了Blake2。

Blake2 是一种相对较新的哈希方法，它提供与 SHA2 相同或更高的安全性，同时也比其他类似算法快得多。虽然确定其速度优于其他哈希方法的基准高度依赖于硬件规格，但对 Substrate 最大的积极影响是它如何大大减少新节点与链同步所需的时间和资源，并在较小程度上减少验证所需的时间。

有关 Blake2 的全面解释，请参阅他们的[官方文档](https://www.blake2.net/blake2.pdf).

## 加密的类型

有两种不同的加密算法实现方式：**对称**加密和非**对称加密**。

### 对称加密

**对称加密**是密码学的一个分支，与非对称加密不同，它不基于单向函数。它使用相同的加密密钥来加密纯文本和解密生成的密文。

对称密码学是历史上一直使用的加密类型，例如恩尼格玛密码和凯撒密码。它今天仍然被广泛使用，并且可以在 web2 和 web3 应用程序中找到。只有一个密钥，并且要求收件人也有权访问它才能访问包含的信息。

### 非对称加密

**非对称**加密是一种使用两种不同密钥（称为密钥对）的加密类型：用于加密纯文本的公钥和对应的用于解密密文的私钥。

公钥用于加密固定长度的消息，该消息只能使用收件人的私钥解密，有时还可以使用设置的密码进行解密。公钥可用于以加密方式验证相应的私钥是否用于创建一段数据，而不会损害私钥本身，例如**使用数字签名**。这对身份、所有权和属性有明显的影响，并且在 web2 和 web3 的许多不同协议中使用。

### 权衡和妥协

对称加密速度更快，密钥中需要的位更少，以实现与非对称加密相同的安全级别。但是，在进行通信之前，它需要一个共享密钥，这给它的完整性带来了问题和潜在的妥协点。另一方面，非对称加密不需要提前共享密钥，从而实现更好的最终用户安全性。

混合对称和非对称密码学通常用于克服非对称密码学的工程问题，因为它速度较慢，并且密钥中需要更多的位才能实现相同的安全级别。它用于加密密钥，然后使用相对轻量级的对称密码对消息进行“繁重的工作”。

## 数字签名

数字签名是一种使用非对称密钥对验证文档或消息真实性的方法。它们用于确保发件人或签名者的文档或消息在传输过程中未被篡改，并供收件人验证所述数据是否准确且来自预期的发件人。

签署数字签名只需要对数学和密码学有低层次的理解。举个概念性的例子——在签署支票时，预计支票不能多次兑现。这不是签名系统的功能，而是支票序列化系统的功能。银行将检查支票上的序列号是否尚未使用。数字签名本质上结合了这两个概念，允许*签名本身*通过无法复制的唯一加密指纹提供序列化。

与笔和纸签名不同，数字签名的知识不能用于创建其他签名。数字签名通常用于官僚程序，因为它们比简单地扫描签名并将其粘贴到文档上更安全。

Substrate 提供多种不同的加密方案，并且支持任何实现了[`Pair` trait](https://paritytech.github.io/substrate/master/sp_core/crypto/trait.Pair.html)的方法.

## 椭圆曲线

区块链技术需要能够让多个密钥为区块提案和验证创建签名。为此，椭圆曲线数字签名算法（ECDSA）和Schnorr签名是两种最常用的方法。虽然ECDSA是一个更简单的实现，但Schnorr签名在多重签名方面更有效。

Schnorr签名比[ECDSA](https://docs.substrate.io/learn/cryptography/#ecdsa)/EdDSA方案多了一些显著的功能：

- 它更适合分层确定性密钥派生。
- 它通过[签名聚合](https://bitcoincore.org/en/2017/03/23/schnorr-signature-aggregation/)允许本机多重签名.
- 它通常更能抵抗误用。

在ECDSA上使用Schnorr签名时，一个牺牲是两者都需要64个字节，但只有ECDSA签名需要其公钥。

### 各种实现

#### ECDSA

Substrate使用[secp256k1](https://en.bitcoin.it/wiki/Secp256k1)曲线提供[ECDSA](https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm)签名方案。 这与用于保护[比特币](https://en.wikipedia.org/wiki/Bitcoin)和[以太坊](https://en.wikipedia.org/wiki/Ethereum)安全的加密算法相同.

#### Ed25519

[Ed25519](https://en.wikipedia.org/wiki/EdDSA#Ed25519)是一种 EdDSA 签名方案，使用[Curve25519](https://en.wikipedia.org/wiki/Curve25519). 它在设计和实现的几个级别上精心设计，可在不影响安全性的情况下实现非常高的速度。

#### SR25519

[SR25519](https://research.web3.foundation/en/latest/polkadot/keys/1-accounts-more.html)基于与[Ed25519](https://docs.substrate.io/learn/cryptography/#ed25519). 但是，它使用Schnorr签名而不是EdDSA方案。

## 下一步去哪里

- [Polkadot 上的密码学](https://wiki.polkadot.network/docs/en/learn-cryptography).
- [W3F的研究：密码学](https://research.web3.foundation/en/latest/crypto.html).
- [`Hash`](https://paritytech.github.io/substrate/master/sp_runtime/traits/trait.Hash.html)实现新哈希算法的trait。
- [`Pair`](https://paritytech.github.io/substrate/master/sp_core/crypto/trait.Pair.html)实现新加密方案的trait。
